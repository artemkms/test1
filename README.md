Решите задачу ниже. 

Код должен открываться в браузере, без архивов, GitHub будет идеальным.

Задача

Не ожидаем production-ready решения. Сделайте, как кажется правильным, опишите процесс поиска и принятые решения.

Опишите решение для веб-приложения в kubernetes в виде yaml-манифеста. Оставляйте в коде комментарии по принятым решениям. Есть следующие вводные:

у нас мультизональный кластер (три зоны), в котором пять нод
приложение требует около 5-10 секунд для инициализации
по результатам нагрузочного теста известно, что 4 пода справляются с пиковой нагрузкой
на первые запросы приложению требуется значительно больше ресурсов CPU, в дальнейшем потребление ровное в районе 0.1 CPU. По памяти всегда “ровно” в районе 128M memory
приложение имеет дневной цикл по нагрузке – ночью запросов на порядки меньше, пик – днём
хотим максимально отказоустойчивый deployment
хотим минимального потребления ресурсов от этого deployment’а


Для решения данной задачи мы можем использовать Kubernetes Deployment для управления развертыванием нашего приложения в кластере Kubernetes. Мы можем использовать следующие параметры конфигурации:

replicas: количество реплик нашего приложения.
strategy: тип стратегии развертывания (например, RollingUpdate или Recreate).
maxUnavailable: максимальное количество недоступных реплик во время обновления.
minReadySeconds: минимальное количество времени, которое должно пройти после запуска каждой реплики перед тем, как она будет рассматриваться как готовая.
resources: ресурсы, запрошенные каждой репликой.
В соответствии с вводными данными мы можем использовать следующую конфигурацию: yaml file

Здесь мы задали:

replicas: 4 реплики, что позволит нашему приложению справиться с пиковой нагрузкой.
resources: каждая реплика запросит 1 CPU в начале и 0.1 CPU в дальнейшем, а также 128 МБ памяти.
readinessProbe и livenessProbe: проверки готовности и жизнеспособности нашего приложения с помощью HTTP-запросов на порт 80 каждые 5 секунд.
nodeSelector: мы выбираем узлы только в первой зоне, чтобы обеспечить отказоустойчивость.
Кроме того, мы можем использовать Kubernetes Horizontal Pod Autoscaler (HPA) для автоматического масштабирования количества реплик в зависимости от нагрузки на приложение. Мы можем использовать следующую конфигурацию:

yaml2
